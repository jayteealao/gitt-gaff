# Workflow: Update INDEX.md

This workflow refreshes a category's INDEX.md file to reflect current contents.

---

## Step 1: Select Category

**Ask:** Which INDEX.md would you like to update?

1. **plans** - Plans index
2. **architecture** - Architecture index
3. **examples** - Examples index
4. **research** - Research index
5. **analysis** - Analysis index
6. **all** - Update all indexes

**Wait for response.**

---

## Step 2: Scan Directory

For the selected category (or each category if "all"):

```bash
# List all .md files except INDEX.md
ls -la .claude/{category}/*.md 2>/dev/null | grep -v INDEX.md
```

**If directory doesn't exist:**
```
Directory .claude/{category}/ doesn't exist.

Options:
1. Create it (empty with INDEX.md only)
2. Skip this category
3. Cancel

Choose (1-3): _
```

**If directory is empty (no files besides INDEX.md):**
- Create INDEX.md with `file_count: 0`
- Note "No files in this category"

---

## Step 3: Parse Each File

For each `.md` file (excluding INDEX.md):

1. Read YAML frontmatter
2. Extract fields:
   - `title`
   - `status` (or "n/a" for examples)
   - `created`
   - First non-empty line after frontmatter as summary
3. Build entry for the table

**Frontmatter parsing:**
```
Read file → Extract YAML between --- markers → Parse fields
```

**If file has invalid frontmatter:**
- Log warning
- Use filename as title
- Use "unknown" for missing fields
- Include in index with warning marker

---

## Step 4: Group Files

Organize files by status:

### Plans
- **Active**: draft, in-progress, approved
- **Completed**: implemented
- **Archived**: superseded

### Architecture
- **Active**: proposed, accepted
- **Completed**: (none - architecture decisions stay active)
- **Archived**: deprecated, superseded

### Examples
- **Active**: all (examples don't have status)
- **Completed**: (none)
- **Archived**: (none)

### Research
- **Active**: in-progress
- **Completed**: complete
- **Archived**: (none)

### Analysis
- **Active**: in-progress
- **Completed**: complete
- **Archived**: (none)

---

## Step 5: Collect Tags

Aggregate all unique tags from files:

```
For each file:
  Read tags array from frontmatter
  Add each tag to master tag list
  Track which files have each tag
```

---

## Step 6: Generate INDEX.md

Use the [index-template.md](../templates/index-template.md) structure:

**Frontmatter:**
```yaml
---
title: {Category} Index
category: index
updated: {today's date}
file_count: {count of files}
---
```

**Files Table:**
```markdown
| File | Status | Created | Summary |
|------|--------|---------|---------|
| [filename](./filename) | status | YYYY-MM-DD | First line summary |
```

**By Status sections:**
- Only include sections that have files
- List files with links and summaries

**By Tag sections:**
- Only include tags that have files
- List files under each tag

**Footer:**
```markdown
---
*Auto-generated by claude-workspace skill. Last updated: YYYY-MM-DD*
```

---

## Step 7: Write INDEX.md

Write to `.claude/{category}/INDEX.md`

**If INDEX.md exists:**
- Overwrite completely (it's auto-generated)

**If INDEX.md doesn't exist:**
- Create new file

---

## Step 8: Confirmation

**Single category:**
```
Updated .claude/{category}/INDEX.md

Files indexed: {count}
- Active: {count}
- Completed: {count}
- Archived: {count}

Tags found: {list of tags}
```

**All categories:**
```
Updated all INDEX.md files:

| Category | Files | Status |
|----------|-------|--------|
| plans | {n} | ✓ Updated |
| architecture | {n} | ✓ Updated |
| examples | {n} | ✓ Updated |
| research | {n} | ✓ Updated |
| analysis | {n} | ✓ Updated |

Total files indexed: {total}
```

---

## Error Handling

### File with invalid frontmatter

```
Warning: {filename} has invalid or missing frontmatter

Including in index with:
- Title: {filename without extension}
- Status: unknown
- Created: file modification date

Consider fixing this file's frontmatter.
```

### Empty category

```
Category '{category}' has no files (only INDEX.md).

INDEX.md updated to reflect empty category.
```

### Permission error

```
Error: Cannot write to .claude/{category}/INDEX.md
Check file permissions and try again.
```
